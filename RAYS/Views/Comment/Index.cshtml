@model IEnumerable<RAYS.ViewModels.CommentViewModel>

@{
    ViewBag.Title = "Comments";
    int postId = ViewBag.PostId;
}

<h2>Comments for Post @postId</h2>

<!-- Back to Posts Button -->
<button onclick="window.location.href='/Post'">Back to Posts</button>

<!-- Display error message if present in TempData -->
@if (TempData["ErrorMessage"] != null)
{
    <div class="bg-red-500 text-white p-2 mb-4 rounded-lg">
        @TempData["ErrorMessage"]
    </div>
}

<!-- Comment Form -->
<form asp-action="Add" asp-controller="Comment" method="post" id="commentForm">
    <input type="hidden" name="PostId" value="@postId" />
    <input type="hidden" name="Id" value="0" id="commentId" />
    <div>
        <label for="commentText">Add a Comment:</label>
        <textarea id="commentText" name="Text" rows="3"></textarea>
    </div>
    <button type="submit" id="submitButton">Post</button>
</form>

<hr />


<!-- List of Comments -->
@foreach (var comment in Model)
{
    <div class="comment">
        <p><strong>@comment.UserName</strong> (@comment.CreatedAt):</p>
        <p>@comment.Text</p>

        @if (comment.IsEditable)
        {
            <button onclick="editComment(@comment.Id, '@comment.Text')">Update</button>
            <form asp-action="Delete" asp-controller="Comment" method="post" style="display:inline;">
                <input type="hidden" name="id" value="@comment.Id" />
                <input type="hidden" name="postId" value="@postId" />
                <button type="submit">Delete</button>
            </form>
        }
    </div>
}

@section Scripts {
    <script>
        function editComment(commentId, text) {
            document.getElementById('commentId').value = commentId;
            document.getElementById('commentText').value = text;
            document.getElementById('submitButton').textContent = "Change";
            document.getElementById('commentForm').action = '/Comment/Add'; // Re-use Add action for both add and update
        }

        document.getElementById('commentForm').onsubmit = function() {
            // Reset the button text to "Post" after submit
            document.getElementById('submitButton').textContent = "Post";
        };
    </script>
}
